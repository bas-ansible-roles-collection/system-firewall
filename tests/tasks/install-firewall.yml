---
# Tests the relevant firewall package is installed correctly

- name: determine if firewall package is installed - CentOS/firewalld
  command: rpm -qa
  when: ansible_distribution == "CentOS"
  changed_when: False
  register: system_firewall_test_fact_firewall_package_is_installed
- name: assert firewall package is installed - CentOS/firewalld
  assert:
    that:
      - "'firewalld' in system_firewall_test_fact_firewall_package_is_installed.stdout"
  when: ansible_distribution == "CentOS"

- name: determine if firewall package is installed - Ubuntu/UFW
  command: dpkg -s ufw
  when: ansible_distribution == "Ubuntu"
  changed_when: False
  register: system_firewall_test_fact_firewall_package_is_installed
- name: assert firewall package is installed - Ubuntu/UFW
  assert:
    that:
      - "'install ok installed' in system_firewall_test_fact_firewall_package_is_installed.stdout"
  when: ansible_distribution == "Ubuntu"

- name: determine firewall status - CentOS/firewalld
  command: firewall-cmd --state
  when: ansible_distribution == "CentOS"
  changed_when: False
  register: system_firewall_test_fact_firewall_is_running
- name: assert firewall is running - CentOS/firewalld
  assert:
    that:
      - "'running' in system_firewall_test_fact_firewall_is_running.stdout"
  when: ansible_distribution == "CentOS"

- name: determine firewall status - Ubuntu/UFW
  command: ufw status
  when: ansible_distribution == "Ubuntu"
  changed_when: False
  register: system_firewall_test_fact_firewall_is_running
- name: assert firewall is running - Ubuntu/UFW
  assert:
    that:
      - "'Status: active' in system_firewall_test_fact_firewall_is_running.stdout"
  when: ansible_distribution == "Ubuntu"
